var str = [
  {
    timestamp: "Genesis time",
    lastHash: "----",
    hash: "f78ed219d5b60a3665e7382fe68f97cf837bacc732v924n143mf7b401a6002e4",
    data: [],
    nonce: 0,
    difficulty: 3
  },
  {
    timestamp: 1555145255595,
    lastHash:
      "f78ed219d5b60a3665e7382fe68f97cf837bacc732v924n143mf7b401a6002e4",
    hash: "0050334fb451fe23730fdc8b8d4c0eead9d5b05f2d81e57fd0bf6c3af80b7949",
    data: [
      {
        input: {
          timestamp: 1555145255280,
          transaction_type: "register_transaction",
          transaction_sender:
            "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCYF50cAzq5ZwYDxvVCSFSH1a2b\nW+zlAf18yMjNa2i6YnUvmNBjjLMrr2pG+Qmm4dBUqfiYUsOVyR/BgDfRbNoaOsy2\nCmrU1Z1R2u1qsgCQCTbYmffaY9muRfEjKdh+/Shj6QIcZAS81Tr7a+yIXVA06w3k\nvMJ2pzX7v97DEEcNtQIDAQAB\n-----END PUBLIC KEY-----",
          signature:
            "472c4b467dfdb2d50e7055b1e6ed358339132d4eb4a34dd9e71f64050b2f067029a0550229c7116ef077d8409e96efd0c5ce2e6a67385b61aaa2a1b7ca3b723ff6d5877561ff652051020c60296e8bd8a2db355ce15d878248d0e9a91043840b63dd25d783959ce5a77742d024369d5860f481c826cdd1827e1a238f9988cf3d"
        },
        outputs: [
          {
            mobilePhone: "5453543",
            email: "alex@mail.ru",
            fio: "Alex 123",
            user:
              "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCYF50cAzq5ZwYDxvVCSFSH1a2b\nW+zlAf18yMjNa2i6YnUvmNBjjLMrr2pG+Qmm4dBUqfiYUsOVyR/BgDfRbNoaOsy2\nCmrU1Z1R2u1qsgCQCTbYmffaY9muRfEjKdh+/Shj6QIcZAS81Tr7a+yIXVA06w3k\nvMJ2pzX7v97DEEcNtQIDAQAB\n-----END PUBLIC KEY-----"
          }
        ]
      }
    ],
    nonce: 42,
    difficulty: 2
  },
  {
    timestamp: 1555145272259,
    lastHash:
      "0050334fb451fe23730fdc8b8d4c0eead9d5b05f2d81e57fd0bf6c3af80b7949",
    hash: "08c502b4995b1897dd71092eb551f2429c174d566f6a72add23832af01309821",
    data: [
      {
        input: {
          timestamp: 1555145271943,
          transaction_type: "register_transaction",
          transaction_sender:
            "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC33frHLPbbLYH2XypUb5BTKMeq\nnTXfaPv2ZUHQ3x9i1pVAtMbFO+Sr4chmOf1hjRi3UIbbuF4ge2mBwJvuprDIwFaA\nWM4Qa37jhU7BqgwGX3vjBuOKEXaUnlgzSK6OrHZCuKGMav40gDsqnw3805BH+Mpq\nJhpOlf1EmgNsjL0+eQIDAQAB\n-----END PUBLIC KEY-----",
          signature:
            "97f463f544973c6578cece6ceb10d7ace011131cbbf1d338c19aca759eb228b7471aa04a97ca9b7ec282bd1cf69d19cfe2f615709508a539d7a70e87b80fa664e4514e5a2b7e59d2f5093704b33b7572dde4e6537f94f72081dd6bb8316a1e304c4d1e22a84eaf0948b20a46d8d1434b631bafd9d8c0a9e17f9a19a866e130d7"
        },
        outputs: [
          {
            mobilePhone: "5453543",
            email: "ivan@mail.ru",
            fio: "Alex 123",
            user:
              "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC33frHLPbbLYH2XypUb5BTKMeq\nnTXfaPv2ZUHQ3x9i1pVAtMbFO+Sr4chmOf1hjRi3UIbbuF4ge2mBwJvuprDIwFaA\nWM4Qa37jhU7BqgwGX3vjBuOKEXaUnlgzSK6OrHZCuKGMav40gDsqnw3805BH+Mpq\nJhpOlf1EmgNsjL0+eQIDAQAB\n-----END PUBLIC KEY-----"
          }
        ]
      }
    ],
    nonce: 12,
    difficulty: 1
  },
  {
    timestamp: 1555145402861,
    lastHash:
      "08c502b4995b1897dd71092eb551f2429c174d566f6a72add23832af01309821",
    hash: "8d6383643121bb719987958809211aa91d1630cad0f08462b11fc88e3ac572c3",
    data: [
      {
        input: {
          timestamp: 1555145402559,
          transaction_type: "sign_transaction",
          transaction_sender:
            "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCYF50cAzq5ZwYDxvVCSFSH1a2b\nW+zlAf18yMjNa2i6YnUvmNBjjLMrr2pG+Qmm4dBUqfiYUsOVyR/BgDfRbNoaOsy2\nCmrU1Z1R2u1qsgCQCTbYmffaY9muRfEjKdh+/Shj6QIcZAS81Tr7a+yIXVA06w3k\nvMJ2pzX7v97DEEcNtQIDAQAB\n-----END PUBLIC KEY-----",
          signature:
            "61b87e71a970be361d851be64eb46f7a304f46b9e347be67b0a47dbdf66db7ac198c7ef122b334dac4dac5697ece08c51e6f3db765532b477060bba5fd3d96dd4a738b47f913d11a6b9c1f6adc93c2ae0594e05db1e315cf70450ec2d78ae14f7096c56b4d108067aee4427c67c57a90647cea8036848b3c4be374e7e04be700"
        },
        outputs: [
          {
            user:
              "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCYF50cAzq5ZwYDxvVCSFSH1a2b\nW+zlAf18yMjNa2i6YnUvmNBjjLMrr2pG+Qmm4dBUqfiYUsOVyR/BgDfRbNoaOsy2\nCmrU1Z1R2u1qsgCQCTbYmffaY9muRfEjKdh+/Shj6QIcZAS81Tr7a+yIXVA06w3k\nvMJ2pzX7v97DEEcNtQIDAQAB\n-----END PUBLIC KEY-----",
            doc_hash: "7e5006fd453f11438f6b834ebbd85e18",
            doc_signature:
              "3b8f9454527141be4da55c5e9379462b86d9ab2b16383720e622d9d98c80701ac4354c80bd7dcf397aa94e3813a308a3d22c62c1c7038411f13ea45f4f43b81e0e328e46dcf6caf99d077114577dbfa53c01bfaf300515ad1b1462434f735347172ab020526202320e4de80c0470fcfdcb0ab773b32d09469875dbff87e661cf",
            signers:
              "0050334fb451fe23730fdc8b8d4c0eead9d5b05f2d81e57fd0bf6c3af80b7949, 08c502b4995b1897dd71092eb551f2429c174d566f6a72add23832af01309821"
          }
        ]
      }
    ],
    nonce: 1,
    difficulty: 3
  },
  {
    timestamp: 1555145461920,
    lastHash:
      "8d6383643121bb719987958809211aa91d1630cad0f08462b11fc88e3ac572c3",
    hash: "00e27ef37cd1cf00550011e5169d4a49f6cec5bc299e61b918d00531312fd4fa",
    data: [
      {
        input: {
          timestamp: 1555145461603,
          transaction_type: "sign_transaction",
          transaction_sender:
            "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC33frHLPbbLYH2XypUb5BTKMeq\nnTXfaPv2ZUHQ3x9i1pVAtMbFO+Sr4chmOf1hjRi3UIbbuF4ge2mBwJvuprDIwFaA\nWM4Qa37jhU7BqgwGX3vjBuOKEXaUnlgzSK6OrHZCuKGMav40gDsqnw3805BH+Mpq\nJhpOlf1EmgNsjL0+eQIDAQAB\n-----END PUBLIC KEY-----",
          signature:
            "8711f0780b5757d868ad6a767cde18ee6f983cc8ae03433cb0cea3025a7446510f565da94030499cf61fb35e1ec3fd387a83b5ba3d0a18a2ffe293fc218a03c1db02717bef003715db228986ca5d079814bd4d3d7411c164f09d56ad6969426b1989f0990c42d01c3e9df662fe674084dba29b9119a1a652d27c447cd5c1bb97"
        },
        outputs: [
          {
            user:
              "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC33frHLPbbLYH2XypUb5BTKMeq\nnTXfaPv2ZUHQ3x9i1pVAtMbFO+Sr4chmOf1hjRi3UIbbuF4ge2mBwJvuprDIwFaA\nWM4Qa37jhU7BqgwGX3vjBuOKEXaUnlgzSK6OrHZCuKGMav40gDsqnw3805BH+Mpq\nJhpOlf1EmgNsjL0+eQIDAQAB\n-----END PUBLIC KEY-----",
            doc_hash: "7e5006fd453f11438f6b834ebbd85e18",
            doc_signature:
              "53eed25596d509a1964a0927c37274c9950a4d3d6e7a61288b7784b515bd78d12bde473e305d8ca51d217ff82aeadbc23319cbbea8fe06a7589011e287591f10145a501e3e11b6609e5db82f4bbf6cc780d39ee48c2cfa5b070869d186efd4bcd8e802bc275ef1a1ae9732d1a5f98b9bc5b4a914b2d442523c59351eb5bcfa47",
            signers:
              "0050334fb451fe23730fdc8b8d4c0eead9d5b05f2d81e57fd0bf6c3af80b7949, 08c502b4995b1897dd71092eb551f2429c174d566f6a72add23832af01309821"
          }
        ]
      }
    ],
    nonce: 124,
    difficulty: 2
  }
];

function findCKByID(str, user_id) {
  var res = str.filter(
    a =>
      a.data &&
      a.data.find(
        b =>
          b.input.transaction_type == "change_keypair" &&
          b.outputs[0].user_id == user_id
      )
  );
  console.log(res.length + " res of findCKByID");
  if (res.length == 0) {
    console.log("-1");
    return "-1";
  } else {
    let timestamps = [];
    console.log("res - " + res);
    for (let t of res) {
      timestamps.push(t.data[0].input.timestamp);
    }
    timestamps.sort((a, b) => b - a); // first - the biggest
    console.log("Timestamps -  " + timestamps);
    var res1 = str.find(
      a =>
        a.data &&
        a.data.find(
          b =>
            b.input.transaction_type == "change_keypair" &&
            b.outputs[0].user_id == user_id &&
            a.data[0].input.timestamp == timestamps[0]
        )
    );
    return res1.data[0].outputs[0].new_public;
  }
}

console.log(
  findCKByID(
    str,
    "08c502b4995b1897dd71092eb551f2429c174d566f6a72add23832af01309821"
  )
);
