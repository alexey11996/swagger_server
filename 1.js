var str = [
  {
    timestamp: 1535042150640,
    lastHash:
      "00258ef444e72092b0b060ac84394d642744637257cfdf23bf73a476fa72dd28",
    hash: "08rerer3453453r34534r34534c1d8dcb5227654645645645627ebc5c89f",
    data: [
      {
        input: {
          timestamp: 1535042150638,
          transaction_type: "register_transaction",
          transaction_sender:
            "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDi6oPd0f1YAwJcO87JbZvJdKeb\nlGx9uKc13CeMiCf4cpyx6AHK+iVd0r/EUy9Bnj5ILBRmT9Xx6zTOb6YUHf3kECTu\nU8djKsQD9pETlhZuBTgeO8SbwYmkbCGLP6JbaOydng2rr0hE2vhXndejCPy3sE1H\nZURSsSJphyjFqZrauwIDAQAB\n-----END PUBLIC KEY-----",
          signature:
            "d58e5cf78e5c7e4d1ca95cab913e58b15144a898b480285cf4bb6a084672bd5362b58b9ad8f0a103b13b1c741a3374bdd3b3b5cfae852f56c0c5720e66b219143b59e4830cfb7542cf390b74703bdd862b9da1ac7b4c891b758805b3ac72430607e4fe80d2e3605a260469830f5bdbddcdf27bb29048adb2d6d12e0e756ff137"
        },
        outputs: [
          {
            mobilePhone: "537563543",
            email: "alex@mail.ru",
            fio: "fio1",
            user:
              "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDi6oPd0f1YAwJcO87JbZvJdKeb\nlGx9uKc13CeMiCf4cpyx6AHK+iVd0r/EUy9Bnj5ILBRmT9Xx6zTOb6YUHf3kECTu\nU8djKsQD9pETlhZuBTgeO8SbwYmkbCGLP6JbaOydng2rr0hE2vhXndejCPy3sE1H\nZURSsSJphyjFqZrauwIDAQAB\n-----END PUBLIC KEY-----"
          }
        ]
      }
    ],
    nonce: 14,
    difficulty: 1
  },
  {
    timestamp: 1535042150640,
    lastHash:
      "00258ef444e72092b0b060ac84394d642744637257cfdf23bf73a476fa72dd28",
    hash: "08c1d8dcb5256y65y4y46y5y46ya7d9031c0759e2518c51c827ebc5c89f",
    data: [
      {
        input: {
          timestamp: 1535042150638,
          transaction_type: "register_transaction",
          transaction_sender:
            "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDi6oPd0f1YAwJcO87JbZvJdKeb\nlGx9uKc13CeMiCf4cpyx6AHK+iVd0r/EUy9Bnj5ILBRmT9Xx6zTOb6YUHf3kECTu\nU8djKsQD9pETlhZuBTgeO8SbwYmkbCGLP6JbaOydng2rr0hE2vhXndejCPy3sE1H\nZURSsSJphyjFqZrauwIDAQAB\n-----END PUBLIC KEY-----",
          signature:
            "d58e5cf78e5c7e4d1ca95cab913e58b15144a898b480285cf4bb6a084672bd5362b58b9ad8f0a103b13b1c741a3374bdd3b3b5cfae852f56c0c5720e66b219143b59e4830cfb7542cf390b74703bdd862b9da1ac7b4c891b758805b3ac72430607e4fe80d2e3605a260469830f5bdbddcdf27bb29048adb2d6d12e0e756ff137"
        },
        outputs: [
          {
            mobilePhone: "53443243",
            email: "tom@gmail.com",
            fio: "fio",
            user:
              "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDi6oPd0f1YAwJcO87JbZvJdKeb\nlGx9uKc13CeMiCf4cpyx6AHK+iVd0r/EUy9Bnj5ILBRmT9Xx6zTOb6YUHf3kECTu\nU8djKsQD9pETlhZuBTgeO8SbwYmkbCGLP6JbaOydng2rr0hE2vhXndejCPy3sE1H\nZURSsSJphyjFqZrauwIDAQAB\n-----END PUBLIC KEY-----"
          }
        ]
      }
    ],
    nonce: 14,
    difficulty: 1
  },
  {
    timestamp: 1535042150640,
    lastHash:
      "00258ef444e72092b0b060ac84394d642744637257cfdf23bf73a476fa72dd28",
    hash: "08c1d8dcb5256y65y4y46y5y46ya7d9031c0759e2518c51c827ebc5c89f",
    data: [
      {
        input: {
          timestamp: 1535042150638,
          transaction_type: "sign_transaction",
          transaction_sender:
            "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDi6oPd0f1YAwJcO87JbZvJdKeb\nlGx9uKc13CeMiCf4cpyx6AHK+iVd0r/EUy9Bnj5ILBRmT9Xx6zTOb6YUHf3kECTu\nU8djKsQD9pETlhZuBTgeO8SbwYmkbCGLP6JbaOydng2rr0hE2vhXndejCPy3sE1H\nZURSsSJphyjFqZrauwIDAQAB\n-----END PUBLIC KEY-----",
          signature:
            "d58e5cf78e5c7e4d1ca95cab913e58b15144a898b480285cf4bb6a084672bd5362b58b9ad8f0a103b13b1c741a3374bdd3b3b5cfae852f56c0c5720e66b219143b59e4830cfb7542cf390b74703bdd862b9da1ac7b4c891b758805b3ac72430607e4fe80d2e3605a260469830f5bdbddcdf27bb29048adb2d6d12e0e756ff137"
        },
        outputs: [
          {
            mobilePhone: "53443243",
            email: "tomas@gmail.com",
            doc_hash: "12331345",
            user:
              "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDi6oPd0f1YAwJcO87JbZvJdKeb\nlGx9uKc13CeMiCf4cpyx6AHK+iVd0r/EUy9Bnj5ILBRmT9Xx6zTOb6YUHf3kECTu\nU8djKsQD9pETlhZuBTgeO8SbwYmkbCGLP6JbaOydng2rr0hE2vhXndejCPy3sE1H\nZURSsSJphyjFqZrauwIDAQAB\n-----END PUBLIC KEY-----"
          }
        ]
      }
    ],
    nonce: 14,
    difficulty: 1
  },
  {
    timestamp: 1535042150640,
    lastHash:
      "00258ef444e72092b0b060ac84394d642744637257cfdf23bf73a476fa72dd28",
    hash: "08c1d8dcb5256y65y4y46y5y46ya7d9031c0759e2518c51c827ebc5c89f",
    data: [
      {
        input: {
          timestamp: 1535042150638,
          transaction_type: "sign_transaction",
          transaction_sender:
            "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDi6oPd0f1YAwJcO87JbZvJdKeb\nlGx9uKc13CeMiCf4cpyx6AHK+iVd0r/EUy9Bnj5ILBRmT9Xx6zTOb6YUHf3kECTu\nU8djKsQD9pETlhZuBTgeO8SbwYmkbCGLP6JbaOydng2rr0hE2vhXndejCPy3sE1H\nZURSsSJphyjFqZrauwIDAQAB\n-----END PUBLIC KEY-----",
          signature:
            "d58e5cf78e5c7e4d1ca95cab913e58b15144a898b480285cf4bb6a084672bd5362b58b9ad8f0a103b13b1c741a3374bdd3b3b5cfae852f56c0c5720e66b219143b59e4830cfb7542cf390b74703bdd862b9da1ac7b4c891b758805b3ac72430607e4fe80d2e3605a260469830f5bdbddcdf27bb29048adb2d6d12e0e756ff137"
        },
        outputs: [
          {
            mobilePhone: "53443243",
            email: "tim@gmail.com",
            doc_hash: "12331345",
            user:
              "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDi6oPd0f1YAwJcO87JbZvJdKeb\nlGx9uKc13CeMiCf4cpyx6AHK+iVd0r/EUy9Bnj5ILBRmT9Xx6zTOb6YUHf3kECTu\nU8djKsQD9pETlhZuBTgeO8SbwYmkbCGLP6JbaOydng2rr0hE2vhXndejCPy3sE1H\nZURSsSJphyjFqZrauwIDAQAB\n-----END PUBLIC KEY-----"
          }
        ]
      }
    ],
    nonce: 14,
    difficulty: 1
  }
];

var mystr = [
  {
    timestamp: "Genesis time",
    lastHash: "----",
    hash: "f78ed219d5b60a3665e7382fe68f97cf837bacc732v924n143mf7b401a6002e4",
    data: [],
    nonce: 0,
    difficulty: 3
  },
  {
    timestamp: 1536487912946,
    lastHash:
      "f78ed219d5b60a3665e7382fe68f97cf837bacc732v924n143mf7b401a6002e4",
    hash: "007191782441e01f5f82394728f978ddb13352e58752de41d0aacc0ee4639bf0",
    data: [
      {
        input: {
          timestamp: 1536487912932,
          transaction_type: "register_transaction",
          transaction_sender:
            "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCd0TAJmqoHEW+lu91yoXEQnQ//\npaWUYWKOVPVESoXyYb7KZKSssuKofsTpUp/a/AE7Spr2glu7VN3sVpzkEqx7eIWb\n9kWO8SSZ45Cbp1pBTMd5El7Hmnj9U98IS2tCOLVpkveiLdApyIuXBJ3hM5UX1PTw\n3GB++leprm7Edu1B4QIDAQAB\n-----END PUBLIC KEY-----",
          signature:
            "0c03483f1be1bce59e435b18f777d99362e3fdfca12d4d6a26ba4ba416d7b4011df1674f808c3e94a6c44186f7d148678c17f892815a08952ac28948ba371da1cb917c92e160d5afdacb71ebef587788057dce4819b24f5a7ec172ba7e7549b2dcc8ca962ac80a6ba66c2200de03cd26400b0d34357c2e25c0d8fdeb5b9db6fe"
        },
        outputs: [
          {
            mobilePhone: "534543543",
            email: "lexa1548@mail.ru",
            fio: "Алексей M",
            user:
              "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCd0TAJmqoHEW+lu91yoXEQnQ//\npaWUYWKOVPVESoXyYb7KZKSssuKofsTpUp/a/AE7Spr2glu7VN3sVpzkEqx7eIWb\n9kWO8SSZ45Cbp1pBTMd5El7Hmnj9U98IS2tCOLVpkveiLdApyIuXBJ3hM5UX1PTw\n3GB++leprm7Edu1B4QIDAQAB\n-----END PUBLIC KEY-----"
          }
        ]
      }
    ],
    nonce: 52,
    difficulty: 2
  },
  {
    timestamp: 1536488024854,
    lastHash:
      "007191782441e01f5f82394728f978ddb13352e58752de41d0aacc0ee4639bf0",
    hash: "06ba3e577329490cffe120bb013ded784e3cde5f68e4fa1cd1530ccc43d874f3",
    data: [
      {
        input: {
          timestamp: 1536488029852,
          transaction_type: "change_keypair",
          transaction_sender:
            "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCd0TAJmqoHEW+lu91yoXEQnQ//\npaWUYWKOVPVESoXyYb7KZKSssuKofsTpUp/a/AE7Spr2glu7VN3sVpzkEqx7eIWb\n9kWO8SSZ45Cbp1pBTMd5El7Hmnj9U98IS2tCOLVpkveiLdApyIuXBJ3hM5UX1PTw\n3GB++leprm7Edu1B4QIDAQAB\n-----END PUBLIC KEY-----",
          signature:
            "055e6f115387bd74338265bfa4c3b6d28cd57fe9eadd5f3d184fb8a0521aa13ff2eb40d08e2282cec80f772adf93b37c454ddc5e14cf47e59db0599fd24b7d2136a86c527bfafae6f5e1282514c2981266e74486e231da6a844005e668d9e4018f4fc7a5e7212f70b0253a7beda9c3bfafe374221bdf2a2a85a4318045f898bc"
        },
        outputs: [
          {
            user_id:
              "007191782441e01f5f82394728f978ddb13352e58752de41d0aacc0ee4639bf0",
            prev_public:
              "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCd0TAJmqoHEW+lu91yoXEQnQ//\npaWUYWKOVPVESoXyYb7KZKSssuKofsTpUp/a/AE7Spr2glu7VN3sVpzkEqx7eIWb\n9kWO8SSZ45Cbp1pBTMd5El7Hmnj9U98IS2tCOLVpkveiLdApyIuXBJ3hM5UX1PTw\n3GB++leprm7Edu1B4QIDAQAB\n-----END PUBLIC KEY-----",
            new_public:
              "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC1GOIgUlf4+EyM6GCTOxn6ZGAj\nUSlpet84JC7HF+oA65c3CP6GopHJHiJ9S605nCJ2cQzB+Fk/nWlePITIPr81srps\nMmA7kvq23l7YBKWm6Gb+ScbIJ9NgZ6BcTB/1wqcMFq42c04rdAKS/J2Y9UgsxEjR\nPWLUrCvZjr2bYQgQoQIDAQAB\n-----END PUBLIC KEY-----"
          }
        ]
      }
    ],
    nonce: 16,
    difficulty: 1
  },
  {
    timestamp: 1536488029848,
    lastHash:
      "06ba3e577329490cffe120bb013ded784e3cde5f68e4fa1cd1530ccc43d874f3",
    hash: "5557c3d9136d4da6a846690e018f95b335a6627009bfc5760d6f8b1d3c593713",
    data: [
      {
        input: {
          timestamp: 1536488829846,
          transaction_type: "change_keypair",
          transaction_sender:
            "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCd0TAJmqoHEW+lu91yoXEQnQ//\npaWUYWKOVPVESoXyYb7KZKSssuKofsTpUp/a/AE7Spr2glu7VN3sVpzkEqx7eIWb\n9kWO8SSZ45Cbp1pBTMd5El7Hmnj9U98IS2tCOLVpkveiLdApyIuXBJ3hM5UX1PTw\n3GB++leprm7Edu1B4QIDAQAB\n-----END PUBLIC KEY-----",
          signature:
            "42335a57dcd25f8a672af0961f2a689f8cce7fb8d73f4cf14fff75ddc67a56af33fa745b1dcd2b810dba2342f301ecf0ea82c1c966321bb75e8e91233a1c8e0445ce3e3c7798047f7d1554aa21b7ea38a721bfa3b85ecc1f3bb52c5b9b13c43ccf9c5d4432117e60f2647dc247137f8d85161fbbce314c6a0fcab57b52f425a6"
        },
        outputs: [
          {
            user_id:
              "007191782441e01f5f82394728f978ddb13352e58752de41d0aacc0ee4639bf0",
            prev_public:
              "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCd0TAJmqoHEW+lu91yoXEQnQ//\npaWUYWKOVPVESoXyYb7KZKSssuKofsTpUp/a/AE7Spr2glu7VN3sVpzkEqx7eIWb\n9kWO8SSZ45Cbp1pBTMd5El7Hmnj9U98IS2tCOLVpkveiLdApyIuXBJ3hM5UX1PTw\n3GB++leprm7Edu1B4QIDAQAB\n-----END PUBLIC KEY-----",
            new_public:
              "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCy+cPe42AWcCRIfkXQBpUvTtrx\nr259pz1Ez/CyUqh9hA9WTmi0obsgQ28CFJ4uj6AYSIEPX6k7m9YZr1S2es4TWDIw\nW8Szh1VzLS7FpveyickgCbMertIYlQbwkn2L/KMV1xaRnzsngQJ9COujXOmYzFJn\n08yp+hbptZuxsC2rowIDAQAB\n-----END PUBLIC KEY-----"
          }
        ]
      }
    ],
    nonce: 1,
    difficulty: 3
  }
  // {
  //   timestamp: 1536488034344,
  //   lastHash:
  //     "5557c3d9136d4da6a846690e018f95b335a6627009bfc5760d6f8b1d3c593713",
  //   hash: "00bf2011bdfad411acfd5813cd0c0f27caf539b89fe459512cb490efc474b03b",
  //   data: [
  //     {
  //       input: {
  //         timestamp: 1536488038325,
  //         transaction_type: "change_keypair",
  //         transaction_sender:
  //           "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCd0TAJmqoHEW+lu91yoXEQnQ//\npaWUYWKOVPVESoXyYb7KZKSssuKofsTpUp/a/AE7Spr2glu7VN3sVpzkEqx7eIWb\n9kWO8SSZ45Cbp1pBTMd5El7Hmnj9U98IS2tCOLVpkveiLdApyIuXBJ3hM5UX1PTw\n3GB++leprm7Edu1B4QIDAQAB\n-----END PUBLIC KEY-----",
  //         signature:
  //           "20fd9d9910fe49da5a30d2319b8df13cfcf3059d4d6052474b1d2ec5ef5cc327eccc751bbc0ad8e48bad9b330a7f5c41cc69d6a9771ea8c5b33beba85e9ee8be152f8727baeb2d661e16f2636239e5416dd859964be8bef7fee8a0239801826f2a2f0226475f76f1ad249844b952b1d82d74717d7c575e7a47965c5eb5570909"
  //       },
  //       outputs: [
  //         {
  //           user_id:
  //             "007191782441e01f5f82394728f978ddb13352e58752de41d0aacc0ee4639bf0",
  //           prev_public:
  //             "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCd0TAJmqoHEW+lu91yoXEQnQ//\npaWUYWKOVPVESoXyYb7KZKSssuKofsTpUp/a/AE7Spr2glu7VN3sVpzkEqx7eIWb\n9kWO8SSZ45Cbp1pBTMd5El7Hmnj9U98IS2tCOLVpkveiLdApyIuXBJ3hM5UX1PTw\n3GB++leprm7Edu1B4QIDAQAB\n-----END PUBLIC KEY-----",
  //           new_public:
  //             "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDIAvoyIbIFy6NjAo2ZzKzNvqrJ\n6GrDE1iZQjFG8QG3xrbBa4FIBibT4hWRe5PSn9oplBely9AAKdIsAqRdfu+GE4TV\n2Dcb/ba1eXSCIWKBgG4Z8RU8RTJ3+HRYj7rVnKuDUU36hkVaP6bgTe4jqh1eGra7\n13HlVLv2ObCoCR4K6wIDAQAB\n-----END PUBLIC KEY-----"
  //         }
  //       ]
  //     }
  //   ],
  //   nonce: 119,
  //   difficulty: 2
  // }
];
function x(str, user_id) {
  var res = str.filter(
    a =>
      a.data &&
      a.data.find(
        b =>
          b.input.transaction_type == "change_keypair" &&
          b.outputs[0].user_id == user_id
      )
  );
  console.log(res);
  if (res == undefined) {
    return -1;
  } else {
    timestamps = [];
    for (let t of res) {
      timestamps.push(t.data[0].input.timestamp);
    }
    timestamps.sort((a, b) => b - a); // first - the biggest
    var res1 = str.find(
      a =>
        a.data &&
        a.data.find(
          b =>
            b.input.transaction_type == "change_keypair" &&
            b.outputs[0].user_id == user_id &&
            a.data[0].input.timestamp == timestamps[0]
        )
    );
    return res1.data[0].outputs[0].new_public;
  }
}

console.log(
  x(mystr, "007191782441e01f5f82394728f978ddb13352e58752de41d0aacc0ee4639bf0")
);
